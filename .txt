print("Nettleware Alpha script starting...")

local success, err = pcall(function()
    -- Core Services
    local UserInputService = game:GetService("UserInputService")
    local RunService = game:GetService("RunService")
    local TweenService = game:GetService("TweenService")
    local Camera = workspace.CurrentCamera
    local PlayersService = game:GetService("Players")
    local HttpService = game:GetService("HttpService")
    local Lighting = game:GetService("Lighting")

    local LocalPlayer = PlayersService.LocalPlayer or PlayersService.PlayerAdded:Wait()

    -- File-based config
    local configFile = "NettlewareConfig.json"

    -- Default settings (removed speed-related settings)
    local settings = {
        aimbotEnabled = false,
        deadCheck = false,
        teamCheck = false,
        aimbotSmoothnessEnabled = false,
        aimbotSmoothness = 0.5,
        aimbotFovEnabled = false,
        aimbotFovSize = 100,
        aimbotBone = "Head",
        espToggles = {
            Box = false,
            Name = false,
            Speed = false,
            HealthBar = false,
            Tracer = false,
            Skeleton = false,
            Box3D = false
        },
        fullbrightEnabled = false,
        flyEnabled = false,
        flySpeed = 75,
        noClipEnabled = false,
        infiniteJumpEnabled = false,
        saveLastPositionEnabled = false,
        playerListEnabled = false,
        guiBind = Enum.KeyCode.Q,
        unbindAll = false,
        keyBinds = {
            Aimbot = nil,
            DeadCheck = nil,
            TeamCheck = nil,
            Smoothness = nil,
            FovCircle = nil,
            Fly = nil,
            NoClip = nil,
            InfiniteJump = nil,
            SaveLastPosition = nil,
            PlayerList = nil
        }
    }

    local function simpleEncode(tbl)
        local str = "{"
        for k, v in pairs(tbl) do
            if type(v) == "table" then
                str = str .. k .. "=" .. simpleEncode(v) .. ","
            else
                str = str .. k .. "=" .. tostring(v) .. ","
            end
        end
        return str .. "}"
    end

    local function simpleDecode(str)
        return settings
    end

    local useHttpService = pcall(function() return HttpService:JSONEncode({}) end)

    local function loadSettings()
        if not pcall(function() return readfile(configFile) end) then
            print("No config file found, using default settings.")
            return
        end
        local fileContent = readfile(configFile)
        if useHttpService then
            local success, data = pcall(function() return HttpService:JSONDecode(fileContent) end)
            if success and data then
                for key, value in pairs(data) do
                    settings[key] = value
                end
                print("Settings loaded successfully via HttpService.")
            else
                warn("Failed to decode JSON: " .. tostring(data))
            end
        else
            settings = simpleDecode(fileContent)
            print("Settings loaded using fallback method (HttpService unavailable).")
        end
    end

    local function saveSettings()
        local encoded
        if useHttpService then
            local success, result = pcall(function() return HttpService:JSONEncode(settings) end)
            if not success then
                warn("Failed to encode settings to JSON: " .. tostring(result))
                return
            end
            encoded = result
        else
            encoded = simpleEncode(settings)
        end
        local writeSuccess = pcall(function() writefile(configFile, encoded) end)
        if not writeSuccess then
            warn("Failed to write to " .. configFile .. ". Check permissions or executor compatibility.")
        else
            print("Settings saved successfully.")
        end
    end

    loadSettings()

    local function getCharacter()
        return LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    end

    -- Main GUI Setup (unchanged)
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "NettlewareAlphaGUI"
    ScreenGui.ResetOnSpawn = false
    ScreenGui.IgnoreGuiInset = true

    local successCoreGui, errCoreGui = pcall(function()
        ScreenGui.Parent = game:GetService("CoreGui")
    end)
    if not successCoreGui then
        warn("Failed to parent to CoreGui: " .. tostring(errCoreGui))
        ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
        print("Falling back to PlayerGui for GUI parenting.")
    end

    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 600, 0, 600)
    MainFrame.Position = UDim2.new(0.5, -300, 0.5, -300)
    MainFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 30)
    MainFrame.BorderSizePixel = 0
    MainFrame.Parent = ScreenGui
    print("MainFrame created and parented to ScreenGui.")

    -- Draggable Functionality (unchanged)
    local dragging, dragInput, dragStart, startPos
    local function update(input)
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end

    MainFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    MainFrame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)

    -- GUI Toggle with Visibility (unchanged)
    local guiVisible = true
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if not gameProcessed and input.KeyCode == settings.guiBind then
            guiVisible = not guiVisible
            MainFrame.Visible = guiVisible
            print("GUI toggled to " .. (guiVisible and "visible" or "hidden") .. ". Press '" .. settings.guiBind.Name .. "' to toggle.")
        end
    end)

    -- Background with Circuit Pattern (unchanged)
    local CircuitBackground = Instance.new("ImageLabel")
    CircuitBackground.Size = UDim2.new(1, 0, 1, 0)
    CircuitBackground.BackgroundTransparency = 1
    CircuitBackground.Image = "rbxassetid://10758317539"
    CircuitBackground.ImageColor3 = Color3.fromRGB(0, 100, 255)
    CircuitBackground.ImageTransparency = 0.7
    CircuitBackground.Parent = MainFrame

    -- Pulsing Neon Effect (unchanged)
    local NeonPulse = Instance.new("UIStroke")
    NeonPulse.Thickness = 2
    NeonPulse.Color = Color3.fromRGB(0, 200, 255)
    NeonPulse.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    NeonPulse.Parent = MainFrame
    spawn(function()
        while true do
            for i = 0.7, 1, 0.01 do
                CircuitBackground.ImageTransparency = i
                wait(0.01)
            end
            for i = 1, 0.7, -0.01 do
                CircuitBackground.ImageTransparency = i
                wait(0.01)
            end
        end
    end)

    -- Title (unchanged)
    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Size = UDim2.new(0, 400, 0, 50)
    TitleLabel.Position = UDim2.new(0.5, -200, 0, 20)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Text = "Nettleware Alpha"
    TitleLabel.TextColor3 = Color3.fromRGB(0, 200, 255)
    TitleLabel.Font = Enum.Font.SourceSansBold
    TitleLabel.TextSize = 24
    TitleLabel.TextStrokeTransparency = 0
    TitleLabel.TextStrokeColor3 = Color3.fromRGB(0, 100, 255)
    TitleLabel.Parent = MainFrame

    -- Discord Links at Bottom Corners (unchanged)
    local DiscordLeft = Instance.new("TextLabel")
    DiscordLeft.Size = UDim2.new(0, 150, 0, 20)
    DiscordLeft.Position = UDim2.new(0, 10, 1, -30)
    DiscordLeft.BackgroundTransparency = 1
    DiscordLeft.Text = "discord.gg/YxaqVDMVC5"
    DiscordLeft.TextColor3 = Color3.fromRGB(0, 200, 255)
    DiscordLeft.Font = Enum.Font.SourceSans
    DiscordLeft.TextSize = 14
    DiscordLeft.Parent = MainFrame

    local DiscordRight = Instance.new("TextLabel")
    DiscordRight.Size = UDim2.new(0, 150, 0, 20)
    DiscordRight.Position = UDim2.new(1, -160, 1, -30)
    DiscordRight.BackgroundTransparency = 1
    DiscordRight.Text = "discord.gg/YxaqVDMVC5"
    DiscordRight.TextColor3 = Color3.fromRGB(0, 200, 255)
    DiscordRight.Font = Enum.Font.SourceSans
    DiscordRight.TextSize = 14
    DiscordRight.Parent = MainFrame

    -- Tab Buttons (unchanged)
    local tabs = {"Aimbot", "Visuals", "Exploits", "Settings"}
    local currentTab = nil
    local tabContents = {}

    local tabWidth = 100
    local tabSpacing = 20
    local totalTabsWidth = (#tabs * tabWidth) + ((#tabs - 1) * tabSpacing)
    local startX = (600 - totalTabsWidth) / 2

    for i, tabName in ipairs(tabs) do
        local xPos = startX + ((i - 1) * (tabWidth + tabSpacing))

        local TabButton = Instance.new("TextButton")
        TabButton.Size = UDim2.new(0, tabWidth, 0, 40)
        TabButton.Position = UDim2.new(0, xPos, 0, 80)
        TabButton.Text = tabName
        TabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        TabButton.BackgroundColor3 = Color3.fromRGB(0, 70, 140)
        TabButton.BackgroundTransparency = 0
        TabButton.TextTransparency = 0
        TabButton.Font = Enum.Font.SourceSansBold
        TabButton.TextSize = 16
        TabButton.BorderSizePixel = 0
        TabButton.Parent = MainFrame

        local Content = Instance.new("ScrollingFrame")
        Content.Size = UDim2.new(0, 300, 0, 400)
        Content.Position = UDim2.new(0.5, -150, 0, 130)
        Content.BackgroundColor3 = Color3.fromRGB(0, 40, 80)
        Content.BackgroundTransparency = 0
        Content.BorderSizePixel = 0
        Content.Visible = false
        Content.ScrollBarThickness = 5
        Content.Parent = MainFrame
        tabContents[tabName] = Content

        TabButton.MouseButton1Click:Connect(function()
            if currentTab ~= tabName then
                local previousTab = currentTab
                currentTab = tabName
                for name, content in pairs(tabContents) do
                    if content.Visible then
                        local slideOut = TweenService:Create(content, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {Position = UDim2.new(0.5, -150, 1, 0)})
                        slideOut:Play()
                        wait(0.3)
                        content.Visible = false
                    end
                end
                local newContent = tabContents[tabName]
                newContent.Position = UDim2.new(0.5, -150, 1, 0)
                newContent.Visible = true
                local slideIn = TweenService:Create(newContent, TweenInfo.new(0.3, Enum.EasingStyle.Quad), {Position = UDim2.new(0.5, -150, 0, 130)})
                slideIn:Play()
                print("Switched to " .. tabName .. " tab.")
            end
        end)
    end

    -- Aimbot Tab Content (unchanged)
    local aimbotEnabled = settings.aimbotEnabled
    local deadCheck = settings.deadCheck
    local teamCheck = settings.teamCheck
    local aimbotSmoothnessEnabled = settings.aimbotSmoothnessEnabled
    local aimbotSmoothness = settings.aimbotSmoothness
    local aimbotFovEnabled = settings.aimbotFovEnabled
    local aimbotFovSize = settings.aimbotFovSize
    local aimbotBone = settings.aimbotBone
    local targetPlayer = nil

    local baseY = 10
    local categoryLabelAimbot = Instance.new("TextLabel")
    categoryLabelAimbot.Size = UDim2.new(0, 280, 0, 30)
    categoryLabelAimbot.Position = UDim2.new(0, 10, 0, baseY)
    categoryLabelAimbot.Text = "— Aimbot —"
    categoryLabelAimbot.TextColor3 = Color3.fromRGB(0, 200, 255)
    categoryLabelAimbot.BackgroundTransparency = 1
    categoryLabelAimbot.Font = Enum.Font.SourceSansBold
    categoryLabelAimbot.TextSize = 18
    categoryLabelAimbot.Parent = tabContents["Aimbot"]
    print("Aimbot category label created at Y: " .. baseY)

    local yOffset = baseY + 40
    local AimbotToggle = Instance.new("TextButton")
    AimbotToggle.Size = UDim2.new(0, 240, 0, 30)
    AimbotToggle.Position = UDim2.new(0, 10, 0, yOffset)
    AimbotToggle.Text = "☐ Aimbot: " .. (aimbotEnabled and "ON" or "OFF")
    AimbotToggle.BackgroundTransparency = 1
    AimbotToggle.TextColor3 = aimbotEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
    AimbotToggle.Font = Enum.Font.SourceSans
    AimbotToggle.TextSize = 16
    AimbotToggle.Parent = tabContents["Aimbot"]
    print("Aimbot toggle created at Y: " .. yOffset)

    local AimbotBindSquare = Instance.new("TextButton")
    AimbotBindSquare.Size = UDim2.new(0, 30, 0, 30)
    AimbotBindSquare.Position = UDim2.new(0, 260, 0, yOffset)
    AimbotBindSquare.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    AimbotBindSquare.Text = settings.keyBinds.Aimbot and settings.keyBinds.Aimbot.Name or "Bind"
    AimbotBindSquare.BackgroundTransparency = 0
    AimbotBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
    AimbotBindSquare.Font = Enum.Font.SourceSans
    AimbotBindSquare.TextSize = 12
    AimbotBindSquare.Parent = tabContents["Aimbot"]

    local AimbotUnbindButton = Instance.new("TextButton")
    AimbotUnbindButton.Size = UDim2.new(0, 50, 0, 30)
    AimbotUnbindButton.Position = UDim2.new(0, 300, 0, yOffset)
    AimbotUnbindButton.Text = "Unbind"
    AimbotUnbindButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    AimbotUnbindButton.TextColor3 = Color3.fromRGB(255, 0, 0)
    AimbotUnbindButton.Font = Enum.Font.SourceSans
    AimbotUnbindButton.TextSize = 12
    AimbotUnbindButton.Parent = tabContents["Aimbot"]

    yOffset = yOffset + 40
    local DeadCheckToggle = Instance.new("TextButton")
    DeadCheckToggle.Size = UDim2.new(0, 240, 0, 30)
    DeadCheckToggle.Position = UDim2.new(0, 10, 0, yOffset)
    DeadCheckToggle.Text = "☐ Dead Check: " .. (deadCheck and "ON" or "OFF")
    DeadCheckToggle.BackgroundTransparency = 1
    DeadCheckToggle.TextColor3 = deadCheck and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
    DeadCheckToggle.Font = Enum.Font.SourceSans
    DeadCheckToggle.TextSize = 16
    DeadCheckToggle.Parent = tabContents["Aimbot"]
    print("DeadCheck toggle created at Y: " .. yOffset)

    local DeadCheckBindSquare = Instance.new("TextButton")
    DeadCheckBindSquare.Size = UDim2.new(0, 30, 0, 30)
    DeadCheckBindSquare.Position = UDim2.new(0, 260, 0, yOffset)
    DeadCheckBindSquare.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    DeadCheckBindSquare.Text = settings.keyBinds.DeadCheck and settings.keyBinds.DeadCheck.Name or "Bind"
    DeadCheckBindSquare.BackgroundTransparency = 0
    DeadCheckBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
    DeadCheckBindSquare.Font = Enum.Font.SourceSans
    DeadCheckBindSquare.TextSize = 12
    DeadCheckBindSquare.Parent = tabContents["Aimbot"]

    local DeadCheckUnbindButton = Instance.new("TextButton")
    DeadCheckUnbindButton.Size = UDim2.new(0, 50, 0, 30)
    DeadCheckUnbindButton.Position = UDim2.new(0, 300, 0, yOffset)
    DeadCheckUnbindButton.Text = "Unbind"
    DeadCheckUnbindButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    DeadCheckUnbindButton.TextColor3 = Color3.fromRGB(255, 0, 0)
    DeadCheckUnbindButton.Font = Enum.Font.SourceSans
    DeadCheckUnbindButton.TextSize = 12
    DeadCheckUnbindButton.Parent = tabContents["Aimbot"]

    yOffset = yOffset + 40
    local TeamCheckToggle = Instance.new("TextButton")
    TeamCheckToggle.Size = UDim2.new(0, 240, 0, 30)
    TeamCheckToggle.Position = UDim2.new(0, 10, 0, yOffset)
    TeamCheckToggle.Text = "☐ Team Check: " .. (teamCheck and "ON" or "OFF")
    TeamCheckToggle.BackgroundTransparency = 1
    TeamCheckToggle.TextColor3 = teamCheck and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
    TeamCheckToggle.Font = Enum.Font.SourceSans
    TeamCheckToggle.TextSize = 16
    TeamCheckToggle.Parent = tabContents["Aimbot"]
    print("TeamCheck toggle created at Y: " .. yOffset)

    local TeamCheckBindSquare = Instance.new("TextButton")
    TeamCheckBindSquare.Size = UDim2.new(0, 30, 0, 30)
    TeamCheckBindSquare.Position = UDim2.new(0, 260, 0, yOffset)
    TeamCheckBindSquare.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    TeamCheckBindSquare.Text = settings.keyBinds.TeamCheck and settings.keyBinds.TeamCheck.Name or "Bind"
    TeamCheckBindSquare.BackgroundTransparency = 0
    TeamCheckBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
    TeamCheckBindSquare.Font = Enum.Font.SourceSans
    TeamCheckBindSquare.TextSize = 12
    TeamCheckBindSquare.Parent = tabContents["Aimbot"]

    local TeamCheckUnbindButton = Instance.new("TextButton")
    TeamCheckUnbindButton.Size = UDim2.new(0, 50, 0, 30)
    TeamCheckUnbindButton.Position = UDim2.new(0, 300, 0, yOffset)
    TeamCheckUnbindButton.Text = "Unbind"
    TeamCheckUnbindButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    TeamCheckUnbindButton.TextColor3 = Color3.fromRGB(255, 0, 0)
    TeamCheckUnbindButton.Font = Enum.Font.SourceSans
    TeamCheckUnbindButton.TextSize = 12
    TeamCheckUnbindButton.Parent = tabContents["Aimbot"]

    yOffset = yOffset + 40
    local SmoothnessToggle = Instance.new("TextButton")
    SmoothnessToggle.Size = UDim2.new(0, 240, 0, 30)
    SmoothnessToggle.Position = UDim2.new(0, 10, 0, yOffset)
    SmoothnessToggle.Text = "☐ Smoothness: " .. (aimbotSmoothnessEnabled and "ON" or "OFF")
    SmoothnessToggle.BackgroundTransparency = 1
    SmoothnessToggle.TextColor3 = aimbotSmoothnessEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
    SmoothnessToggle.Font = Enum.Font.SourceSans
    SmoothnessToggle.TextSize = 16
    SmoothnessToggle.Parent = tabContents["Aimbot"]
    print("Smoothness toggle created at Y: " .. yOffset)

    local SmoothnessBindSquare = Instance.new("TextButton")
    SmoothnessBindSquare.Size = UDim2.new(0, 30, 0, 30)
    SmoothnessBindSquare.Position = UDim2.new(0, 260, 0, yOffset)
    SmoothnessBindSquare.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    SmoothnessBindSquare.Text = settings.keyBinds.Smoothness and settings.keyBinds.Smoothness.Name or "Bind"
    SmoothnessBindSquare.BackgroundTransparency = 0
    SmoothnessBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
    SmoothnessBindSquare.Font = Enum.Font.SourceSans
    SmoothnessBindSquare.TextSize = 12
    SmoothnessBindSquare.Parent = tabContents["Aimbot"]

    local SmoothnessUnbindButton = Instance.new("TextButton")
    SmoothnessUnbindButton.Size = UDim2.new(0, 50, 0, 30)
    SmoothnessUnbindButton.Position = UDim2.new(0, 300, 0, yOffset)
    SmoothnessUnbindButton.Text = "Unbind"
    SmoothnessUnbindButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    SmoothnessUnbindButton.TextColor3 = Color3.fromRGB(255, 0, 0)
    SmoothnessUnbindButton.Font = Enum.Font.SourceSans
    SmoothnessUnbindButton.TextSize = 12
    SmoothnessUnbindButton.Parent = tabContents["Aimbot"]

    yOffset = yOffset + 40
    local SmoothnessLabel = Instance.new("TextLabel")
    SmoothnessLabel.Size = UDim2.new(0, 280, 0, 30)
    SmoothnessLabel.Position = UDim2.new(0, 10, 0, yOffset)
    SmoothnessLabel.Text = "Smoothness: " .. aimbotSmoothness
    SmoothnessLabel.BackgroundTransparency = 1
    SmoothnessLabel.TextColor3 = Color3.fromRGB(0, 200, 255)
    SmoothnessLabel.Font = Enum.Font.SourceSans
    SmoothnessLabel.TextSize = 16
    SmoothnessLabel.Parent = tabContents["Aimbot"]
    print("Smoothness label created at Y: " .. yOffset)

    yOffset = yOffset + 40
    local SmoothnessSlider = Instance.new("TextButton")
    SmoothnessSlider.Size = UDim2.new(0, 280, 0, 10)
    SmoothnessSlider.Position = UDim2.new(0, 10, 0, yOffset)
    SmoothnessSlider.Text = ""
    SmoothnessSlider.BackgroundColor3 = Color3.fromRGB(0, 70, 140)
    SmoothnessSlider.BackgroundTransparency = 0
    SmoothnessSlider.Parent = tabContents["Aimbot"]
    print("Smoothness slider created at Y: " .. yOffset)

    local SmoothnessKnob = Instance.new("Frame")
    SmoothnessKnob.Size = UDim2.new(0, 20, 1, 0)
    SmoothnessKnob.Position = UDim2.new((aimbotSmoothness - 0.1) / 0.9, 0, 0, 0)
    SmoothnessKnob.BackgroundColor3 = Color3.fromRGB(0, 200, 255)
    SmoothnessKnob.BackgroundTransparency = 0
    SmoothnessKnob.BorderSizePixel = 0
    SmoothnessKnob.Parent = SmoothnessSlider

    yOffset = yOffset + 40
    local FovCircleToggle = Instance.new("TextButton")
    FovCircleToggle.Size = UDim2.new(0, 240, 0, 30)
    FovCircleToggle.Position = UDim2.new(0, 10, 0, yOffset)
    FovCircleToggle.Text = "☐ FOV Circle: " .. (aimbotFovEnabled and "ON" or "OFF")
    FovCircleToggle.BackgroundTransparency = 1
    FovCircleToggle.TextColor3 = aimbotFovEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
    FovCircleToggle.Font = Enum.Font.SourceSans
    FovCircleToggle.TextSize = 16
    FovCircleToggle.Parent = tabContents["Aimbot"]
    print("FovCircle toggle created at Y: " .. yOffset)

    local FovCircleBindSquare = Instance.new("TextButton")
    FovCircleBindSquare.Size = UDim2.new(0, 30, 0, 30)
    FovCircleBindSquare.Position = UDim2.new(0, 260, 0, yOffset)
    FovCircleBindSquare.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    FovCircleBindSquare.Text = settings.keyBinds.FovCircle and settings.keyBinds.FovCircle.Name or "Bind"
    FovCircleBindSquare.BackgroundTransparency = 0
    FovCircleBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
    FovCircleBindSquare.Font = Enum.Font.SourceSans
    FovCircleBindSquare.TextSize = 12
    FovCircleBindSquare.Parent = tabContents["Aimbot"]

    local FovCircleUnbindButton = Instance.new("TextButton")
    FovCircleUnbindButton.Size = UDim2.new(0, 50, 0, 30)
    FovCircleUnbindButton.Position = UDim2.new(0, 300, 0, yOffset)
    FovCircleUnbindButton.Text = "Unbind"
    FovCircleUnbindButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    FovCircleUnbindButton.TextColor3 = Color3.fromRGB(255, 0, 0)
    FovCircleUnbindButton.Font = Enum.Font.SourceSans
    FovCircleUnbindButton.TextSize = 12
    FovCircleUnbindButton.Parent = tabContents["Aimbot"]

    yOffset = yOffset + 40
    local FovCircleLabel = Instance.new("TextLabel")
    FovCircleLabel.Size = UDim2.new(0, 280, 0, 30)
    FovCircleLabel.Position = UDim2.new(0, 10, 0, yOffset)
    FovCircleLabel.Text = "FOV Size: " .. aimbotFovSize
    FovCircleLabel.BackgroundTransparency = 1
    FovCircleLabel.TextColor3 = Color3.fromRGB(0, 200, 255)
    FovCircleLabel.Font = Enum.Font.SourceSans
    FovCircleLabel.TextSize = 16
    FovCircleLabel.Parent = tabContents["Aimbot"]
    print("FovCircle label created at Y: " .. yOffset)

    yOffset = yOffset + 40
    local FovCircleSlider = Instance.new("TextButton")
    FovCircleSlider.Size = UDim2.new(0, 280, 0, 10)
    FovCircleSlider.Position = UDim2.new(0, 10, 0, yOffset)
    FovCircleSlider.Text = ""
    FovCircleSlider.BackgroundColor3 = Color3.fromRGB(0, 70, 140)
    FovCircleSlider.BackgroundTransparency = 0
    FovCircleSlider.Parent = tabContents["Aimbot"]
    print("FovCircle slider created at Y: " .. yOffset)

    local FovCircleKnob = Instance.new("Frame")
    FovCircleKnob.Size = UDim2.new(0, 20, 1, 0)
    FovCircleKnob.Position = UDim2.new((aimbotFovSize - 1) / 639, 0, 0, 0)
    FovCircleKnob.BackgroundColor3 = Color3.fromRGB(0, 200, 255)
    FovCircleKnob.BackgroundTransparency = 0
    FovCircleKnob.BorderSizePixel = 0
    FovCircleKnob.Parent = FovCircleSlider

    yOffset = yOffset + 40
    local AimbotBoneLabel = Instance.new("TextLabel")
    AimbotBoneLabel.Size = UDim2.new(0, 280, 0, 30)
    AimbotBoneLabel.Position = UDim2.new(0, 10, 0, yOffset)
    AimbotBoneLabel.Text = "Aim Bone: " .. aimbotBone
    AimbotBoneLabel.BackgroundTransparency = 1
    AimbotBoneLabel.TextColor3 = Color3.fromRGB(0, 200, 255)
    AimbotBoneLabel.Font = Enum.Font.SourceSans
    AimbotBoneLabel.TextSize = 16
    AimbotBoneLabel.Parent = tabContents["Aimbot"]
    print("AimbotBone label created at Y: " .. yOffset)

    yOffset = yOffset + 40
    local AimbotBoneDropdown = Instance.new("TextButton")
    AimbotBoneDropdown.Size = UDim2.new(0, 280, 0, 30)
    AimbotBoneDropdown.Position = UDim2.new(0, 10, 0, yOffset)
    AimbotBoneDropdown.Text = "▼ " .. aimbotBone
    AimbotBoneDropdown.BackgroundColor3 = Color3.fromRGB(0, 70, 140)
    AimbotBoneDropdown.BackgroundTransparency = 0
    AimbotBoneDropdown.TextColor3 = Color3.fromRGB(0, 200, 255)
    AimbotBoneDropdown.Font = Enum.Font.SourceSans
    AimbotBoneDropdown.TextSize = 16
    AimbotBoneDropdown.BorderSizePixel = 0
    AimbotBoneDropdown.Parent = tabContents["Aimbot"]
    print("AimbotBone dropdown created at Y: " .. yOffset)

    local boneDropdownOpen = false
    local boneDropdownOptions = {"Head", "Body", "Feet"}
    local boneDropdownFrame = Instance.new("Frame")
    boneDropdownFrame.Size = UDim2.new(0, 280, 0, #boneDropdownOptions * 30)
    boneDropdownFrame.Position = UDim2.new(0, 10, 0, yOffset + 30)
    boneDropdownFrame.BackgroundColor3 = Color3.fromRGB(0, 40, 80)
    boneDropdownFrame.BackgroundTransparency = 0
    boneDropdownFrame.Visible = false
    boneDropdownFrame.Parent = tabContents["Aimbot"]
    print("Bone dropdown frame created at Y: " .. (yOffset + 30))

    for i, option in ipairs(boneDropdownOptions) do
        local optionButton = Instance.new("TextButton")
        optionButton.Size = UDim2.new(1, -10, 0, 30)
        optionButton.Position = UDim2.new(0, 5, 0, (i - 1) * 30)
        optionButton.Text = option
        optionButton.BackgroundTransparency = 1
        optionButton.TextColor3 = Color3.fromRGB(0, 200, 255)
        optionButton.Font = Enum.Font.SourceSans
        optionButton.TextSize = 16
        optionButton.Parent = boneDropdownFrame

        optionButton.MouseButton1Click:Connect(function()
            aimbotBone = option
            AimbotBoneLabel.Text = "Aim Bone: " .. aimbotBone
            AimbotBoneDropdown.Text = "▼ " .. aimbotBone
            settings.aimbotBone = aimbotBone
            saveSettings()
            boneDropdownFrame.Visible = false
            boneDropdownOpen = false
        end)
    end

    AimbotBoneDropdown.MouseButton1Click:Connect(function()
        boneDropdownOpen = not boneDropdownOpen
        boneDropdownFrame.Visible = boneDropdownOpen
    end)

    -- Aimbot FOV Circle Drawing (unchanged)
    local fovCircle = Drawing.new("Circle")
    fovCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    fovCircle.Radius = aimbotFovSize
    fovCircle.Color = Color3.fromRGB(255, 0, 0)
    fovCircle.Thickness = 2
    fovCircle.Filled = false
    fovCircle.Visible = aimbotFovEnabled

    -- Aimbot Logic with Bone Selection (unchanged)
    local function isPlayerInFov(player)
        if not aimbotFovEnabled then
            return true
        end
        if not player.Character or not player.Character:FindFirstChild("Head") then
            return false
        end
        local headPos = player.Character.Head.Position
        local screenPos, onScreen = Camera:WorldToViewportPoint(headPos)
        if not onScreen then
            return false
        end
        local distanceFromCenter = (Vector2.new(screenPos.X, screenPos.Y) - Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)).Magnitude
        return distanceFromCenter <= aimbotFovSize
    end

    local function getNearestPlayer()
        local nearestDistance = math.huge
        local nearestPlayer = nil
        local character = getCharacter()
        local rootPart = character:WaitForChild("HumanoidRootPart")
        local localTeam = LocalPlayer.Team

        for _, otherPlayer in pairs(PlayersService:GetPlayers()) do
            if otherPlayer ~= LocalPlayer and otherPlayer.Character and otherPlayer.Character:FindFirstChild("Head") then
                local humanoid = otherPlayer.Character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    local isDead = deadCheck and humanoid.Health <= 0
                    local isSameTeam = teamCheck and localTeam and otherPlayer.Team and (otherPlayer.Team == localTeam)
                    if not isDead and not isSameTeam and isPlayerInFov(otherPlayer) then
                        local distance = (rootPart.Position - otherPlayer.Character.Head.Position).Magnitude
                        if distance < nearestDistance then
                            nearestDistance = distance
                            nearestPlayer = otherPlayer
                        end
                    end
                end
            end
        end
        return nearestPlayer
    end

    local function getAimPart(player)
        if not player.Character then return nil end
        if aimbotBone == "Head" then
            return player.Character:FindFirstChild("Head")
        elseif aimbotBone == "Body" then
            return player.Character:FindFirstChild("UpperTorso") or player.Character:FindFirstChild("Torso") or player.Character:FindFirstChild("HumanoidRootPart")
        elseif aimbotBone == "Feet" then
            local leftFoot = player.Character:FindFirstChild("LeftFoot")
            local rightFoot = player.Character:FindFirstChild("RightFoot")
            return leftFoot or rightFoot or player.Character:FindFirstChild("HumanoidRootPart")
        end
        return player.Character:FindFirstChild("Head")
    end

    AimbotToggle.MouseButton1Click:Connect(function()
        aimbotEnabled = not aimbotEnabled
        AimbotToggle.Text = "☐ Aimbot: " .. (aimbotEnabled and "ON" or "OFF")
        AimbotToggle.TextColor3 = aimbotEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
        settings.aimbotEnabled = aimbotEnabled
        saveSettings()
    end)

    DeadCheckToggle.MouseButton1Click:Connect(function()
        deadCheck = not deadCheck
        DeadCheckToggle.Text = "☐ Dead Check: " .. (deadCheck and "ON" or "OFF")
        DeadCheckToggle.TextColor3 = deadCheck and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
        settings.deadCheck = deadCheck
        saveSettings()
    end)

    TeamCheckToggle.MouseButton1Click:Connect(function()
        teamCheck = not teamCheck
        TeamCheckToggle.Text = "☐ Team Check: " .. (teamCheck and "ON" or "OFF")
        TeamCheckToggle.TextColor3 = teamCheck and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
        settings.teamCheck = teamCheck
        saveSettings()
    end)

    SmoothnessToggle.MouseButton1Click:Connect(function()
        aimbotSmoothnessEnabled = not aimbotSmoothnessEnabled
        SmoothnessToggle.Text = "☐ Smoothness: " .. (aimbotSmoothnessEnabled and "ON" or "OFF")
        SmoothnessToggle.TextColor3 = aimbotSmoothnessEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
        settings.aimbotSmoothnessEnabled = aimbotSmoothnessEnabled
        saveSettings()
    end)

    FovCircleToggle.MouseButton1Click:Connect(function()
        aimbotFovEnabled = not aimbotFovEnabled
        FovCircleToggle.Text = "☐ FOV Circle: " .. (aimbotFovEnabled and "ON" or "OFF")
        FovCircleToggle.TextColor3 = aimbotFovEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
        fovCircle.Visible = aimbotFovEnabled
        settings.aimbotFovEnabled = aimbotFovEnabled
        saveSettings()
    end)

    local draggingSmoothnessSlider = false
    local draggingFovCircleSlider = false

    SmoothnessSlider.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingSmoothnessSlider = true
        end
    end)

    SmoothnessSlider.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingSmoothnessSlider = false
        end
    end)

    FovCircleSlider.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingFovCircleSlider = true
        end
    end)

    FovCircleSlider.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingFovCircleSlider = false
        end
    end)

    RunService.RenderStepped:Connect(function()
        local mouseX = UserInputService:GetMouseLocation().X

        if draggingSmoothnessSlider then
            local smoothnessSliderPos = SmoothnessSlider.AbsolutePosition.X
            local smoothnessSliderWidth = SmoothnessSlider.AbsoluteSize.X
            local smoothnessNewPos = math.clamp((mouseX - smoothnessSliderPos) / smoothnessSliderWidth, 0, 1)
            SmoothnessKnob.Position = UDim2.new(smoothnessNewPos, 0, 0, 0)
            aimbotSmoothness = 0.1 + (smoothnessNewPos * 0.9)
            aimbotSmoothness = math.round(aimbotSmoothness * 10) / 10
            SmoothnessLabel.Text = "Smoothness: " .. aimbotSmoothness
            settings.aimbotSmoothness = aimbotSmoothness
            saveSettings()
        end

        if draggingFovCircleSlider then
            local fovCircleSliderPos = FovCircleSlider.AbsolutePosition.X
            local fovCircleSliderWidth = FovCircleSlider.AbsoluteSize.X
            local fovCircleNewPos = math.clamp((mouseX - fovCircleSliderPos) / fovCircleSliderWidth, 0, 1)
            FovCircleKnob.Position = UDim2.new(fovCircleNewPos, 0, 0, 0)
            aimbotFovSize = math.floor(1 + (fovCircleNewPos * 639))
            FovCircleLabel.Text = "FOV Size: " .. aimbotFovSize
            fovCircle.Radius = aimbotFovSize
            settings.aimbotFovSize = aimbotFovSize
            saveSettings()
        end

        fovCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

        if aimbotEnabled and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
            targetPlayer = getNearestPlayer()
            if targetPlayer and targetPlayer.Character then
                local aimPart = getAimPart(targetPlayer)
                if aimPart then
                    local humanoid = targetPlayer.Character:FindFirstChildOfClass("Humanoid")
                    if humanoid and (not deadCheck or humanoid.Health > 0) and isPlayerInFov(targetPlayer) then
                        local targetPos = aimPart.Position
                        if targetPos.Magnitude < 10000 then
                            local targetCFrame = CFrame.new(Camera.CFrame.Position, targetPos)
                            if aimbotSmoothnessEnabled then
                                local alpha = math.clamp(1 - aimbotSmoothness, 0.01, 1) * RunService.RenderStepped:Wait() * 60
                                Camera.CFrame = Camera.CFrame:Lerp(targetCFrame, alpha)
                            else
                                Camera.CFrame = targetCFrame
                            end
                        end
                    end
                end
            end
        end
    end)

    -- Key Binding Logic (unchanged)
    local bindingFeature = nil
    local function startBinding(bindSquare)
        bindingFeature = bindSquare
        bindSquare.Text = "Press Key"
        bindSquare.TextColor3 = Color3.fromRGB(255, 255, 0)
    end

    local function unbind(featureBindSquare, feature)
        settings.keyBinds[feature] = nil
        featureBindSquare.Text = "Bind"
        featureBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
        saveSettings()
    end

    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if bindingFeature and not gameProcessed then
            if input.UserInputType == Enum.UserInputType.Keyboard then
                local key = input.KeyCode
                local feature = nil
                if bindingFeature == AimbotBindSquare then feature = "Aimbot"
                elseif bindingFeature == DeadCheckBindSquare then feature = "DeadCheck"
                elseif bindingFeature == TeamCheckBindSquare then feature = "TeamCheck"
                elseif bindingFeature == SmoothnessBindSquare then feature = "Smoothness"
                elseif bindingFeature == FovCircleBindSquare then feature = "FovCircle"
                end
                if feature then
                    settings.keyBinds[feature] = key
                    bindingFeature.Text = key.Name
                    bindingFeature.TextColor3 = Color3.fromRGB(0, 200, 255)
                    saveSettings()
                end
                bindingFeature = nil
            end
        elseif not gameProcessed then
            for feature, key in pairs(settings.keyBinds) do
                if key and input.KeyCode == key then
                    if feature == "Aimbot" then
                        aimbotEnabled = not aimbotEnabled
                        AimbotToggle.Text = "☐ Aimbot: " .. (aimbotEnabled and "ON" or "OFF")
                        AimbotToggle.TextColor3 = aimbotEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
                        settings.aimbotEnabled = aimbotEnabled
                    elseif feature == "DeadCheck" then
                        deadCheck = not deadCheck
                        DeadCheckToggle.Text = "☐ Dead Check: " .. (deadCheck and "ON" or "OFF")
                        DeadCheckToggle.TextColor3 = deadCheck and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
                        settings.deadCheck = deadCheck
                    elseif feature == "TeamCheck" then
                        teamCheck = not teamCheck
                        TeamCheckToggle.Text = "☐ Team Check: " .. (teamCheck and "ON" or "OFF")
                        TeamCheckToggle.TextColor3 = teamCheck and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
                        settings.teamCheck = teamCheck
                    elseif feature == "Smoothness" then
                        aimbotSmoothnessEnabled = not aimbotSmoothnessEnabled
                        SmoothnessToggle.Text = "☐ Smoothness: " .. (aimbotSmoothnessEnabled and "ON" or "OFF")
                        SmoothnessToggle.TextColor3 = aimbotSmoothnessEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
                        settings.aimbotSmoothnessEnabled = aimbotSmoothnessEnabled
                    elseif feature == "FovCircle" then
                        aimbotFovEnabled = not aimbotFovEnabled
                        FovCircleToggle.Text = "☐ FOV Circle: " .. (aimbotFovEnabled and "ON" or "OFF")
                        FovCircleToggle.TextColor3 = aimbotFovEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
                        fovCircle.Visible = aimbotFovEnabled
                        settings.aimbotFovEnabled = aimbotFovEnabled
                    end
                    saveSettings()
                end
            end
        end
    end)

    AimbotBindSquare.MouseButton1Click:Connect(function() startBinding(AimbotBindSquare) end)
    AimbotUnbindButton.MouseButton1Click:Connect(function() unbind(AimbotBindSquare, "Aimbot") end)
    DeadCheckBindSquare.MouseButton1Click:Connect(function() startBinding(DeadCheckBindSquare) end)
    DeadCheckUnbindButton.MouseButton1Click:Connect(function() unbind(DeadCheckBindSquare, "DeadCheck") end)
    TeamCheckBindSquare.MouseButton1Click:Connect(function() startBinding(TeamCheckBindSquare) end)
    TeamCheckUnbindButton.MouseButton1Click:Connect(function() unbind(TeamCheckBindSquare, "TeamCheck") end)
    SmoothnessBindSquare.MouseButton1Click:Connect(function() startBinding(SmoothnessBindSquare) end)
    SmoothnessUnbindButton.MouseButton1Click:Connect(function() unbind(SmoothnessBindSquare, "Smoothness") end)
    FovCircleBindSquare.MouseButton1Click:Connect(function() startBinding(FovCircleBindSquare) end)
    FovCircleUnbindButton.MouseButton1Click:Connect(function() unbind(FovCircleBindSquare, "FovCircle") end)

    -- Visuals Tab Content (unchanged)
    local espToggles = settings.espToggles
    local fullbrightEnabled = settings.fullbrightEnabled
    local espPlayers = {}
    local lastPositions = {}

    local function DrawESP(plr)
        local drawings = {
            Box = Drawing.new("Quad"),
            Name = Drawing.new("Text"),
            Speed = Drawing.new("Text"),
            HealthText = Drawing.new("Text"),
            HealthBar = Drawing.new("Square"),
            HealthBarOutline = Drawing.new("Square"),
            Tracer = Drawing.new("Line"),
            Skeleton = {},
            Box3D = {}
        }
        
        drawings.Box.Color = Color3.fromRGB(0, 200, 255)
        drawings.Box.Thickness = 1
        drawings.Box.Transparency = 1
        drawings.Box.Visible = false

        drawings.Name.Size = 18
        drawings.Name.Color = Color3.fromRGB(0, 200, 255)
        drawings.Name.Outline = true
        drawings.Name.Visible = false

        drawings.Speed.Size = 16
        drawings.Speed.Color = Color3.fromRGB(0, 200, 255)
        drawings.Speed.Outline = true
        drawings.Speed.Visible = false

        drawings.HealthText.Size = 16
        drawings.HealthText.Color = Color3.fromRGB(0, 200, 255)
        drawings.HealthText.Outline = true
        drawings.HealthText.Visible = false

        drawings.HealthBar.Thickness = 0
        drawings.HealthBar.Size = Vector2.new(100, 15)
        drawings.HealthBar.Visible = false

        drawings.HealthBarOutline.Thickness = 1
        drawings.HealthBarOutline.Size = Vector2.new(100, 15)
        drawings.HealthBarOutline.Color = Color3.fromRGB(0, 0, 0)
        drawings.HealthBarOutline.Filled = false
        drawings.HealthBarOutline.Visible = false

        drawings.Tracer.Color = Color3.fromRGB(0, 200, 255)
        drawings.Tracer.Thickness = 1
        drawings.Tracer.Visible = false

        local bones = {
            {"Head", "UpperTorso"}, {"UpperTorso", "LowerTorso"},
            {"LowerTorso", "LeftUpperLeg"}, {"LeftUpperLeg", "LeftLowerLeg"}, {"LeftLowerLeg", "LeftFoot"},
            {"LowerTorso", "RightUpperLeg"}, {"RightUpperLeg", "RightLowerLeg"}, {"RightLowerLeg", "RightFoot"},
            {"UpperTorso", "LeftUpperArm"}, {"LeftUpperArm", "LeftLowerArm"}, {"LeftLowerArm", "LeftHand"},
            {"UpperTorso", "RightUpperArm"}, {"RightUpperArm", "RightLowerArm"}, {"RightUpperArm", "RightHand"}
        }
        for _, pair in ipairs(bones) do
            local line = Drawing.new("Line")
            line.Color = Color3.fromRGB(0, 200, 255)
            line.Thickness = 2
            line.Visible = false
            drawings.Skeleton[pair[1] .. pair[2]] = line
        end

        local box3DIndices = {
            {1, 2}, {2, 3}, {3, 4}, {4, 1},
            {5, 6}, {6, 7}, {7, 8}, {8, 5},
            {1, 5}, {2, 6}, {3, 7}, {4, 8}
        }
        for i, edge in ipairs(box3DIndices) do
            local line = Drawing.new("Line")
            line.Color = Color3.fromRGB(0, 200, 255)
            line.Thickness = 1
            line.Visible = false
            drawings.Box3D[i] = line
        end

        local function Update()
            local connection
            local character = getCharacter()
            local rootPart = character:WaitForChild("HumanoidRootPart")
            connection = RunService.RenderStepped:Connect(function()
                if plr.Character and plr.Character.PrimaryPart and plr.Character:FindFirstChildOfClass("Humanoid") and plr.Character:FindFirstChildOfClass("Humanoid").Health > 0 then
                    local head = plr.Character:FindFirstChild("Head") or plr.Character.PrimaryPart
                    local headPos, headVis = Camera:WorldToViewportPoint(head.Position + Vector3.new(0, 2.5, 0))
                    if headVis then
                        local TopLeft = Camera:WorldToViewportPoint((plr.Character.PrimaryPart.CFrame * CFrame.new(-2, 3, 0)).p)
                        local TopRight = Camera:WorldToViewportPoint((plr.Character.PrimaryPart.CFrame * CFrame.new(2, 3, 0)).p)
                        local BottomLeft = Camera:WorldToViewportPoint((plr.Character.PrimaryPart.CFrame * CFrame.new(-2, -3, 0)).p)
                        local BottomRight = Camera:WorldToViewportPoint((plr.Character.PrimaryPart.CFrame * CFrame.new(2, -3, 0)).p)

                        if espToggles.Box then
                            drawings.Box.PointA = Vector2.new(TopRight.X, TopRight.Y)
                            drawings.Box.PointB = Vector2.new(TopLeft.X, TopLeft.Y)
                            drawings.Box.PointC = Vector2.new(BottomLeft.X, BottomLeft.Y)
                            drawings.Box.PointD = Vector2.new(BottomRight.X, BottomRight.Y)
                            drawings.Box.Visible = true
                        else
                            drawings.Box.Visible = false
                        end

                        if espToggles.Name and headVis then
                            local nameWidth = drawings.Name.TextBounds.X
                            drawings.Name.Position = Vector2.new(headPos.X - (nameWidth / 2), headPos.Y - 30)
                            drawings.Name.Text = plr.Name
                            drawings.Name.Visible = true
                        else
                            drawings.Name.Visible = false
                        end

                        if espToggles.Speed and headVis then
                            local currentPos = plr.Character.HumanoidRootPart.Position
                            if not lastPositions[plr] then lastPositions[plr] = currentPos end
                            local lastPos = lastPositions[plr]
                            local delta = (currentPos - lastPos).Magnitude
                            local speed = delta / RunService.RenderStepped:Wait()
                            drawings.Speed.Position = Vector2.new(headPos.X, headPos.Y + 10)
                            drawings.Speed.Text = string.format("Speed: %.1f", speed)
                            lastPositions[plr] = currentPos
                            drawings.Speed.Visible = true
                        else
                            drawings.Speed.Visible = false
                        end

                        if espToggles.HealthBar and headVis then
                            local humanoid = plr.Character:FindFirstChildOfClass("Humanoid")
                            if humanoid then
                                local healthPercent = humanoid.Health / humanoid.MaxHealth
                                local distance = (Camera.CFrame.Position - head.Position).Magnitude
                                local baseWidth = 100
                                local baseHeight = 15
                                local scaleFactor = math.clamp(10 / distance, 0.1, 1)
                                local barWidth = baseWidth * scaleFactor
                                local barHeight = baseHeight * scaleFactor
                                local barX = headPos.X - (barWidth / 2)
                                local barY = headPos.Y

                                drawings.HealthText.Text = math.floor(healthPercent * 100) .. "%"
                                local textWidth = drawings.HealthText.TextBounds.X
                                drawings.HealthText.Position = Vector2.new(barX + (barWidth / 2) - (textWidth / 2), barY - 20 * scaleFactor)
                                drawings.HealthText.Visible = true

                                drawings.HealthBar.Position = Vector2.new(barX, barY)
                                drawings.HealthBar.Size = Vector2.new(barWidth * healthPercent, barHeight)
                                drawings.HealthBar.Color = Color3.fromRGB(255 * (1 - healthPercent), 255 * healthPercent, 0)
                                drawings.HealthBar.Visible = true

                                drawings.HealthBarOutline.Position = Vector2.new(barX, barY)
                                drawings.HealthBarOutline.Size = Vector2.new(barWidth, barHeight)
                                drawings.HealthBarOutline.Visible = true
                            else
                                drawings.HealthText.Visible = false
                                drawings.HealthBar.Visible = false
                                drawings.HealthBarOutline.Visible = false
                            end
                        else
                            drawings.HealthText.Visible = false
                            drawings.HealthBar.Visible = false
                            drawings.HealthBarOutline.Visible = false
                        end

                        if espToggles.Tracer then
                            drawings.Tracer.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
                            drawings.Tracer.To = Vector2.new(headPos.X, headPos.Y)
                            drawings.Tracer.Visible = true
                        else
                            drawings.Tracer.Visible = false
                        end

                        if espToggles.Skeleton then
                            for _, pair in ipairs(bones) do
                                local part1 = plr.Character:FindFirstChild(pair[1])
                                local part2 = plr.Character:FindFirstChild(pair[2])
                                if part1 and part2 then
                                    local pos1, vis1 = Camera:WorldToViewportPoint(part1.Position)
                                    local pos2, vis2 = Camera:WorldToViewportPoint(part2.Position)
                                    if vis1 and vis2 then
                                        local line = drawings.Skeleton[pair[1] .. pair[2]]
                                        line.From = Vector2.new(pos1.X, pos1.Y)
                                        line.To = Vector2.new(pos2.X, pos2.Y)
                                        line.Visible = true
                                    else
                                        drawings.Skeleton[pair[1] .. pair[2]].Visible = false
                                    end
                                else
                                    drawings.Skeleton[pair[1] .. pair[2]].Visible = false
                                end
                            end
                        else
                            for _, line in pairs(drawings.Skeleton) do
                                line.Visible = false
                            end
                        end

                        if espToggles.Box3D then
                            local corners = {
                                plr.Character.PrimaryPart.CFrame * CFrame.new(-2, 3, -2),
                                plr.Character.PrimaryPart.CFrame * CFrame.new(2, 3, -2),
                                plr.Character.PrimaryPart.CFrame * CFrame.new(2, -3, -2),
                                plr.Character.PrimaryPart.CFrame * CFrame.new(-2, -3, -2),
                                plr.Character.PrimaryPart.CFrame * CFrame.new(-2, 3, 2),
                                plr.Character.PrimaryPart.CFrame * CFrame.new(2, 3, 2),
                                plr.Character.PrimaryPart.CFrame * CFrame.new(2, -3, 2),
                                plr.Character.PrimaryPart.CFrame * CFrame.new(-2, -3, 2)
                            }
                            local screenCorners = {}
                            local allVisible = true
                            for i, corner in ipairs(corners) do
                                local screenPos, onScreen = Camera:WorldToViewportPoint(corner.p)
                                screenCorners[i] = Vector2.new(screenPos.X, screenPos.Y)
                                if not onScreen then allVisible = false break end
                            end
                            if allVisible then
                                for i, edge in ipairs(box3DIndices) do
                                    local line = drawings.Box3D[i]
                                    line.From = screenCorners[edge[1]]
                                    line.To = screenCorners[edge[2]]
                                    line.Visible = true
                                end
                            else
                                for _, line in ipairs(drawings.Box3D) do
                                    line.Visible = false
                                end
                            end
                        else
                            for _, line in ipairs(drawings.Box3D) do
                                line.Visible = false
                            end
                        end
                    else
                        for _, drawing in pairs(drawings) do
                            if type(drawing) == "table" then
                                for _, line in pairs(drawing) do
                                    line.Visible = false
                                end
                            else
                                drawing.Visible = false
                            end
                        end
                    end
                else
                    for _, drawing in pairs(drawings) do
                        if type(drawing) == "table" then
                            for _, line in pairs(drawing) do
                                line.Visible = false
                            end
                        else
                            drawing.Visible = false
                        end
                    end
                    if not PlayersService:FindFirstChild(plr.Name) then
                        connection:Disconnect()
                    end
                end
            end)
        end
        coroutine.wrap(Update)()
        espPlayers[plr] = drawings
    end

    for _, player in pairs(PlayersService:GetPlayers()) do
        if player ~= LocalPlayer then
            local success, err = pcall(function()
                DrawESP(player)
            end)
            if not success then
                warn("Failed to apply ESP to player " .. player.Name .. ": " .. err)
            end
        end
    end

    PlayersService.PlayerAdded:Connect(function(player)
        wait(1)
        if player ~= LocalPlayer then
            local success, err = pcall(function()
                DrawESP(player)
            end)
            if not success then
                warn("Failed to apply ESP to player " .. player.Name .. ": " .. err)
            end
        end
    end)

    local baseYVisuals = 10
    local categoryLabelVisuals = Instance.new("TextLabel")
    categoryLabelVisuals.Size = UDim2.new(0, 280, 0, 30)
    categoryLabelVisuals.Position = UDim2.new(0, 10, 0, baseYVisuals)
    categoryLabelVisuals.Text = "— Visuals —"
    categoryLabelVisuals.TextColor3 = Color3.fromRGB(0, 200, 255)
    categoryLabelVisuals.BackgroundTransparency = 1
    categoryLabelVisuals.Font = Enum.Font.SourceSansBold
    categoryLabelVisuals.TextSize = 18
    categoryLabelVisuals.Parent = tabContents["Visuals"]
    print("Visuals category label created at Y: " .. baseYVisuals)

    local yOffsetVisuals = baseYVisuals + 40
    for feature, enabled in pairs(espToggles) do
        local Toggle = Instance.new("TextButton")
        Toggle.Size = UDim2.new(0, 240, 0, 30)
        Toggle.Position = UDim2.new(0, 10, 0, yOffsetVisuals)
        Toggle.Text = "☐ " .. feature .. ": " .. (enabled and "ON" or "OFF")
        Toggle.BackgroundTransparency = 1
        Toggle.TextColor3 = enabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
        Toggle.Font = Enum.Font.SourceSans
        Toggle.TextSize = 16
        Toggle.Parent = tabContents["Visuals"]
        print(feature .. " toggle created at Y: " .. yOffsetVisuals)

        Toggle.MouseButton1Click:Connect(function()
            espToggles[feature] = not espToggles[feature]
            Toggle.Text = "☐ " .. feature .. ": " .. (espToggles[feature] and "ON" or "OFF")
            Toggle.TextColor3 = espToggles[feature] and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
            settings.espToggles[feature] = espToggles[feature]
            saveSettings()
        end)
        yOffsetVisuals = yOffsetVisuals + 40
    end

    yOffsetVisuals = yOffsetVisuals + 10
    local FullbrightToggle = Instance.new("TextButton")
    FullbrightToggle.Size = UDim2.new(0, 240, 0, 30)
    FullbrightToggle.Position = UDim2.new(0, 10, 0, yOffsetVisuals)
    FullbrightToggle.Text = "☐ Fullbright: " .. (fullbrightEnabled and "ON" or "OFF")
    FullbrightToggle.BackgroundTransparency = 1
    FullbrightToggle.TextColor3 = fullbrightEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
    FullbrightToggle.Font = Enum.Font.SourceSans
    FullbrightToggle.TextSize = 16
    FullbrightToggle.Parent = tabContents["Visuals"]
    print("Fullbright toggle created at Y: " .. yOffsetVisuals)

    FullbrightToggle.MouseButton1Click:Connect(function()
        fullbrightEnabled = not fullbrightEnabled
        FullbrightToggle.Text = "☐ Fullbright: " .. (fullbrightEnabled and "ON" or "OFF")
        FullbrightToggle.TextColor3 = fullbrightEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
        if fullbrightEnabled then
            Lighting.Brightness = 2
            Lighting.Ambient = Color3.fromRGB(255, 255, 255)
            Lighting.FogEnd = 100000
        else
            Lighting.Brightness = 1
            Lighting.Ambient = Color3.fromRGB(0, 0, 0)
            Lighting.FogEnd = 100000
        end
        settings.fullbrightEnabled = fullbrightEnabled
        saveSettings()
    end)

    -- Exploits Tab Content (removed speed-related UI)
    local flyEnabled = settings.flyEnabled
    local flySpeed = settings.flySpeed
    local noClipEnabled = settings.noClipEnabled
    local infiniteJumpEnabled = settings.infiniteJumpEnabled
    local saveLastPositionEnabled = settings.saveLastPositionEnabled

    local baseYExploits = 10
    local categoryLabelExploits = Instance.new("TextLabel")
    categoryLabelExploits.Size = UDim2.new(0, 280, 0, 30)
    categoryLabelExploits.Position = UDim2.new(0, 10, 0, baseYExploits)
    categoryLabelExploits.Text = "— Exploits —"
    categoryLabelExploits.TextColor3 = Color3.fromRGB(0, 200, 255)
    categoryLabelExploits.BackgroundTransparency = 1
    categoryLabelExploits.Font = Enum.Font.SourceSansBold
    categoryLabelExploits.TextSize = 18
    categoryLabelExploits.Parent = tabContents["Exploits"]
    print("Exploits category label created at Y: " .. baseYExploits)

    local yOffsetExploits = baseYExploits + 40
    local FlyToggle = Instance.new("TextButton")
    FlyToggle.Size = UDim2.new(0, 240, 0, 30)
    FlyToggle.Position = UDim2.new(0, 10, 0, yOffsetExploits)
    FlyToggle.Text = "☐ Fly: " .. (flyEnabled and "ON" or "OFF")
    FlyToggle.BackgroundTransparency = 1
    FlyToggle.TextColor3 = flyEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
    FlyToggle.Font = Enum.Font.SourceSans
    FlyToggle.TextSize = 16
    FlyToggle.Parent = tabContents["Exploits"]
    print("Fly toggle created at Y: " .. yOffsetExploits)

    local FlyBindSquare = Instance.new("TextButton")
    FlyBindSquare.Size = UDim2.new(0, 30, 0, 30)
    FlyBindSquare.Position = UDim2.new(0, 260, 0, yOffsetExploits)
    FlyBindSquare.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    FlyBindSquare.Text = settings.keyBinds.Fly and settings.keyBinds.Fly.Name or "Bind"
    FlyBindSquare.BackgroundTransparency = 0
    FlyBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
    FlyBindSquare.Font = Enum.Font.SourceSans
    FlyBindSquare.TextSize = 12
    FlyBindSquare.Parent = tabContents["Exploits"]

    local FlyUnbindButton = Instance.new("TextButton")
    FlyUnbindButton.Size = UDim2.new(0, 50, 0, 30)
    FlyUnbindButton.Position = UDim2.new(0, 300, 0, yOffsetExploits)
    FlyUnbindButton.Text = "Unbind"
    FlyUnbindButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    FlyUnbindButton.TextColor3 = Color3.fromRGB(255, 0, 0)
    FlyUnbindButton.Font = Enum.Font.SourceSans
    FlyUnbindButton.TextSize = 12
    FlyUnbindButton.Parent = tabContents["Exploits"]

    yOffsetExploits = yOffsetExploits + 40
    local FlySpeedLabel = Instance.new("TextLabel")
    FlySpeedLabel.Size = UDim2.new(0, 280, 0, 30)
    FlySpeedLabel.Position = UDim2.new(0, 10, 0, yOffsetExploits)
    FlySpeedLabel.Text = "Fly Speed: " .. flySpeed
    FlySpeedLabel.BackgroundTransparency = 1
    FlySpeedLabel.TextColor3 = Color3.fromRGB(0, 200, 255)
    FlySpeedLabel.Font = Enum.Font.SourceSans
    FlySpeedLabel.TextSize = 16
    FlySpeedLabel.Parent = tabContents["Exploits"]
    print("FlySpeed label created at Y: " .. yOffsetExploits)

    yOffsetExploits = yOffsetExploits + 40
    local FlySpeedSlider = Instance.new("TextButton")
    FlySpeedSlider.Size = UDim2.new(0, 280, 0, 10)
    FlySpeedSlider.Position = UDim2.new(0, 10, 0, yOffsetExploits)
    FlySpeedSlider.Text = ""
    FlySpeedSlider.BackgroundColor3 = Color3.fromRGB(0, 70, 140)
    FlySpeedSlider.BackgroundTransparency = 0
    FlySpeedSlider.Parent = tabContents["Exploits"]
    print("FlySpeed slider created at Y: " .. yOffsetExploits)

    local FlySpeedKnob = Instance.new("Frame")
    FlySpeedKnob.Size = UDim2.new(0, 20, 1, 0)
    FlySpeedKnob.Position = UDim2.new((flySpeed - 1) / 299, 0, 0, 0)
    FlySpeedKnob.BackgroundColor3 = Color3.fromRGB(0, 200, 255)
    FlySpeedKnob.BackgroundTransparency = 0
    FlySpeedKnob.BorderSizePixel = 0
    FlySpeedKnob.Parent = FlySpeedSlider

    yOffsetExploits = yOffsetExploits + 40
    local NoClipToggle = Instance.new("TextButton")
    NoClipToggle.Size = UDim2.new(0, 240, 0, 30)
    NoClipToggle.Position = UDim2.new(0, 10, 0, yOffsetExploits)
    NoClipToggle.Text = "☐ NoClip: " .. (noClipEnabled and "ON" or "OFF")
    NoClipToggle.BackgroundTransparency = 1
    NoClipToggle.TextColor3 = noClipEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
    NoClipToggle.Font = Enum.Font.SourceSans
    NoClipToggle.TextSize = 16
    NoClipToggle.Parent = tabContents["Exploits"]
    print("NoClip toggle created at Y: " .. yOffsetExploits)

    local NoClipBindSquare = Instance.new("TextButton")
    NoClipBindSquare.Size = UDim2.new(0, 30, 0, 30)
    NoClipBindSquare.Position = UDim2.new(0, 260, 0, yOffsetExploits)
    NoClipBindSquare.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    NoClipBindSquare.Text = settings.keyBinds.NoClip and settings.keyBinds.NoClip.Name or "Bind"
    NoClipBindSquare.BackgroundTransparency = 0
    NoClipBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
    NoClipBindSquare.Font = Enum.Font.SourceSans
    NoClipBindSquare.TextSize = 12
    NoClipBindSquare.Parent = tabContents["Exploits"]

    local NoClipUnbindButton = Instance.new("TextButton")
    NoClipUnbindButton.Size = UDim2.new(0, 50, 0, 30)
    NoClipUnbindButton.Position = UDim2.new(0, 300, 0, yOffsetExploits)
    NoClipUnbindButton.Text = "Unbind"
    NoClipUnbindButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    NoClipUnbindButton.TextColor3 = Color3.fromRGB(255, 0, 0)
    NoClipUnbindButton.Font = Enum.Font.SourceSans
    NoClipUnbindButton.TextSize = 12
    NoClipUnbindButton.Parent = tabContents["Exploits"]

    yOffsetExploits = yOffsetExploits + 40
    local InfiniteJumpToggle = Instance.new("TextButton")
    InfiniteJumpToggle.Size = UDim2.new(0, 240, 0, 30)
    InfiniteJumpToggle.Position = UDim2.new(0, 10, 0, yOffsetExploits)
    InfiniteJumpToggle.Text = "☐ Infinite Jump: " .. (infiniteJumpEnabled and "ON" or "OFF")
    InfiniteJumpToggle.BackgroundTransparency = 1
    InfiniteJumpToggle.TextColor3 = infiniteJumpEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
    InfiniteJumpToggle.Font = Enum.Font.SourceSans
    InfiniteJumpToggle.TextSize = 16
    InfiniteJumpToggle.Parent = tabContents["Exploits"]
    print("InfiniteJump toggle created at Y: " .. yOffsetExploits)

    local InfiniteJumpBindSquare = Instance.new("TextButton")
    InfiniteJumpBindSquare.Size = UDim2.new(0, 30, 0, 30)
        InfiniteJumpBindSquare.Position = UDim2.new(0, 260, 0, yOffsetExploits)
    InfiniteJumpBindSquare.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    InfiniteJumpBindSquare.Text = settings.keyBinds.InfiniteJump and settings.keyBinds.InfiniteJump.Name or "Bind"
    InfiniteJumpBindSquare.BackgroundTransparency = 0
    InfiniteJumpBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
    InfiniteJumpBindSquare.Font = Enum.Font.SourceSans
    InfiniteJumpBindSquare.TextSize = 12
    InfiniteJumpBindSquare.Parent = tabContents["Exploits"]

    local InfiniteJumpUnbindButton = Instance.new("TextButton")
    InfiniteJumpUnbindButton.Size = UDim2.new(0, 50, 0, 30)
    InfiniteJumpUnbindButton.Position = UDim2.new(0, 300, 0, yOffsetExploits)
    InfiniteJumpUnbindButton.Text = "Unbind"
    InfiniteJumpUnbindButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    InfiniteJumpUnbindButton.TextColor3 = Color3.fromRGB(255, 0, 0)
    InfiniteJumpUnbindButton.Font = Enum.Font.SourceSans
    InfiniteJumpUnbindButton.TextSize = 12
    InfiniteJumpUnbindButton.Parent = tabContents["Exploits"]

    yOffsetExploits = yOffsetExploits + 40
    local SaveLastPositionToggle = Instance.new("TextButton")
    SaveLastPositionToggle.Size = UDim2.new(0, 240, 0, 30)
    SaveLastPositionToggle.Position = UDim2.new(0, 10, 0, yOffsetExploits)
    SaveLastPositionToggle.Text = "☐ Save Last Position: " .. (saveLastPositionEnabled and "ON" or "OFF")
    SaveLastPositionToggle.BackgroundTransparency = 1
    SaveLastPositionToggle.TextColor3 = saveLastPositionEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
    SaveLastPositionToggle.Font = Enum.Font.SourceSans
    SaveLastPositionToggle.TextSize = 16
    SaveLastPositionToggle.Parent = tabContents["Exploits"]
    print("SaveLastPosition toggle created at Y: " .. yOffsetExploits)

    local SaveLastPositionBindSquare = Instance.new("TextButton")
    SaveLastPositionBindSquare.Size = UDim2.new(0, 30, 0, 30)
    SaveLastPositionBindSquare.Position = UDim2.new(0, 260, 0, yOffsetExploits)
    SaveLastPositionBindSquare.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    SaveLastPositionBindSquare.Text = settings.keyBinds.SaveLastPosition and settings.keyBinds.SaveLastPosition.Name or "Bind"
    SaveLastPositionBindSquare.BackgroundTransparency = 0
    SaveLastPositionBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
    SaveLastPositionBindSquare.Font = Enum.Font.SourceSans
    SaveLastPositionBindSquare.TextSize = 12
    SaveLastPositionBindSquare.Parent = tabContents["Exploits"]

    local SaveLastPositionUnbindButton = Instance.new("TextButton")
    SaveLastPositionUnbindButton.Size = UDim2.new(0, 50, 0, 30)
    SaveLastPositionUnbindButton.Position = UDim2.new(0, 300, 0, yOffsetExploits)
    SaveLastPositionUnbindButton.Text = "Unbind"
    SaveLastPositionUnbindButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    SaveLastPositionUnbindButton.TextColor3 = Color3.fromRGB(255, 0, 0)
    SaveLastPositionUnbindButton.Font = Enum.Font.SourceSans
    SaveLastPositionUnbindButton.TextSize = 12
    SaveLastPositionUnbindButton.Parent = tabContents["Exploits"]

    -- Fly Implementation
    local flyConnection = nil
    local function startFlying()
        local character = getCharacter()
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if not humanoid or not rootPart then return end

        humanoid.PlatformStand = true
        local bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.Velocity = Vector3.new(0, 0, 0)
        bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
        bodyVelocity.Parent = rootPart
        local bodyGyro = Instance.new("BodyGyro")
        bodyGyro.P = 9e4
        bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
        bodyGyro.CFrame = rootPart.CFrame
        bodyGyro.Parent = rootPart

        flyConnection = RunService.RenderStepped:Connect(function()
            local moveDirection = Vector3.new(0, 0, 0)
            local cameraCFrame = Camera.CFrame
            local speed = flySpeed

            if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                moveDirection = moveDirection + cameraCFrame.LookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                moveDirection = moveDirection - cameraCFrame.LookVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                moveDirection = moveDirection - cameraCFrame.RightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                moveDirection = moveDirection + cameraCFrame.RightVector
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                moveDirection = moveDirection + Vector3.new(0, 1, 0)
            end
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
                moveDirection = moveDirection - Vector3.new(0, 1, 0)
            end

            if moveDirection.Magnitude > 0 then
                moveDirection = moveDirection.Unit
            end

            bodyVelocity.Velocity = moveDirection * speed
            bodyGyro.CFrame = cameraCFrame
        end)
    end

    local function stopFlying()
        local character = getCharacter()
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        local rootPart = character:FindFirstChild("HumanoidRootPart")
        if not humanoid or not rootPart then return end

        humanoid.PlatformStand = false
        if rootPart:FindFirstChild("BodyVelocity") then
            rootPart:FindFirstChild("BodyVelocity"):Destroy()
        end
        if rootPart:FindFirstChild("BodyGyro") then
            rootPart:FindFirstChild("BodyGyro"):Destroy()
        end
        if flyConnection then
            flyConnection:Disconnect()
            flyConnection = nil
        end
    end

    -- No-Clip Implementation
    local noClipConnection = nil
    local function updateNoClip(state)
        if noClipConnection then
            noClipConnection:Disconnect()
            noClipConnection = nil
        end
        
        local character = getCharacter()
        if not character then return end

        if state then
            noClipConnection = RunService.Stepped:Connect(function()
                for _, part in pairs(character:GetDescendants()) do
                    if part:IsA("BasePart") and part.CanCollide then
                        part.CanCollide = false
                    end
                end
            end)
        else
            for _, part in pairs(character:GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = true
                end
            end
        end
    end

    -- Infinite Jump Implementation
    local canInfiniteJump = false
    UserInputService.JumpRequest:Connect(function()
        if infiniteJumpEnabled and canInfiniteJump then
            local character = getCharacter()
            local humanoid = character and character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end
    end)

    -- Save Last Position Implementation
    local lastPosition = nil
    local function savePosition()
        local character = getCharacter()
        local rootPart = character and character:FindFirstChild("HumanoidRootPart")
        if rootPart then
            lastPosition = rootPart.Position
        end
    end

    local function loadPosition()
        local character = getCharacter()
        local rootPart = character and character:FindFirstChild("HumanoidRootPart")
        if rootPart and lastPosition then
            rootPart.CFrame = CFrame.new(lastPosition)
        end
    end

    -- Exploit Toggle Connections
    FlyToggle.MouseButton1Click:Connect(function()
        flyEnabled = not flyEnabled
        FlyToggle.Text = "☐ Fly: " .. (flyEnabled and "ON" or "OFF")
        FlyToggle.TextColor3 = flyEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
        settings.flyEnabled = flyEnabled
        saveSettings()
        if flyEnabled then
            startFlying()
        else
            stopFlying()
        end
    end)

    local draggingFlySpeedSlider = false
    FlySpeedSlider.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingFlySpeedSlider = true
        end
    end)

    FlySpeedSlider.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            draggingFlySpeedSlider = false
        end
    end)

    NoClipToggle.MouseButton1Click:Connect(function()
        noClipEnabled = not noClipEnabled
        NoClipToggle.Text = "☐ NoClip: " .. (noClipEnabled and "ON" or "OFF")
        NoClipToggle.TextColor3 = noClipEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
        settings.noClipEnabled = noClipEnabled
        saveSettings()
        updateNoClip(noClipEnabled)
    end)

    InfiniteJumpToggle.MouseButton1Click:Connect(function()
        infiniteJumpEnabled = not infiniteJumpEnabled
        InfiniteJumpToggle.Text = "☐ Infinite Jump: " .. (infiniteJumpEnabled and "ON" or "OFF")
        InfiniteJumpToggle.TextColor3 = infiniteJumpEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
        settings.infiniteJumpEnabled = infiniteJumpEnabled
        canInfiniteJump = infiniteJumpEnabled
        saveSettings()
    end)

    SaveLastPositionToggle.MouseButton1Click:Connect(function()
        saveLastPositionEnabled = not saveLastPositionEnabled
        SaveLastPositionToggle.Text = "☐ Save Last Position: " .. (saveLastPositionEnabled and "ON" or "OFF")
        SaveLastPositionToggle.TextColor3 = saveLastPositionEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
        settings.saveLastPositionEnabled = saveLastPositionEnabled
        if saveLastPositionEnabled then
            savePosition()
        else
            loadPosition()
        end
        saveSettings()
    end)

    -- Exploit Keybinds
    FlyBindSquare.MouseButton1Click:Connect(function() startBinding(FlyBindSquare) end)
    FlyUnbindButton.MouseButton1Click:Connect(function() unbind(FlyBindSquare, "Fly") end)
    NoClipBindSquare.MouseButton1Click:Connect(function() startBinding(NoClipBindSquare) end)
    NoClipUnbindButton.MouseButton1Click:Connect(function() unbind(NoClipBindSquare, "NoClip") end)
    InfiniteJumpBindSquare.MouseButton1Click:Connect(function() startBinding(InfiniteJumpBindSquare) end)
    InfiniteJumpUnbindButton.MouseButton1Click:Connect(function() unbind(InfiniteJumpBindSquare, "InfiniteJump") end)
    SaveLastPositionBindSquare.MouseButton1Click:Connect(function() startBinding(SaveLastPositionBindSquare) end)
    SaveLastPositionUnbindButton.MouseButton1Click:Connect(function() unbind(SaveLastPositionBindSquare, "SaveLastPosition") end)

    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if not gameProcessed then
            for feature, key in pairs(settings.keyBinds) do
                if key and input.KeyCode == key then
                    if feature == "Fly" then
                        flyEnabled = not flyEnabled
                        FlyToggle.Text = "☐ Fly: " .. (flyEnabled and "ON" or "OFF")
                        FlyToggle.TextColor3 = flyEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
                        settings.flyEnabled = flyEnabled
                        if flyEnabled then startFlying() else stopFlying() end
                    elseif feature == "NoClip" then
                        noClipEnabled = not noClipEnabled
                        NoClipToggle.Text = "☐ NoClip: " .. (noClipEnabled and "ON" or "OFF")
                        NoClipToggle.TextColor3 = noClipEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
                        settings.noClipEnabled = noClipEnabled
                        updateNoClip(noClipEnabled)
                    elseif feature == "InfiniteJump" then
                        infiniteJumpEnabled = not infiniteJumpEnabled
                        InfiniteJumpToggle.Text = "☐ Infinite Jump: " .. (infiniteJumpEnabled and "ON" or "OFF")
                        InfiniteJumpToggle.TextColor3 = infiniteJumpEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
                        settings.infiniteJumpEnabled = infiniteJumpEnabled
                        canInfiniteJump = infiniteJumpEnabled
                    elseif feature == "SaveLastPosition" then
                        saveLastPositionEnabled = not saveLastPositionEnabled
                        SaveLastPositionToggle.Text = "☐ Save Last Position: " .. (saveLastPositionEnabled and "ON" or "OFF")
                        SaveLastPositionToggle.TextColor3 = saveLastPositionEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
                        settings.saveLastPositionEnabled = saveLastPositionEnabled
                        if saveLastPositionEnabled then savePosition() else loadPosition() end
                    end
                    saveSettings()
                end
            end
        end
    end)

    -- Slider Updates for Exploits
    RunService.RenderStepped:Connect(function()
        local mouseX = UserInputService:GetMouseLocation().X

        if draggingFlySpeedSlider then
            local flySpeedSliderPos = FlySpeedSlider.AbsolutePosition.X
            local flySpeedSliderWidth = FlySpeedSlider.AbsoluteSize.X
            local flySpeedNewPos = math.clamp((mouseX - flySpeedSliderPos) / flySpeedSliderWidth, 0, 1)
            FlySpeedKnob.Position = UDim2.new(flySpeedNewPos, 0, 0, 0)
            flySpeed = math.floor(1 + (flySpeedNewPos * 299))
            FlySpeedLabel.Text = "Fly Speed: " .. flySpeed
            settings.flySpeed = flySpeed
            saveSettings()
        end
    end)

    -- Settings Tab Content
    local playerListEnabled = settings.playerListEnabled
    local unbindAll = settings.unbindAll

    local baseYSettings = 10
    local categoryLabelSettings = Instance.new("TextLabel")
    categoryLabelSettings.Size = UDim2.new(0, 280, 0, 30)
    categoryLabelSettings.Position = UDim2.new(0, 10, 0, baseYSettings)
    categoryLabelSettings.Text = "— Settings —"
    categoryLabelSettings.TextColor3 = Color3.fromRGB(0, 200, 255)
    categoryLabelSettings.BackgroundTransparency = 1
    categoryLabelSettings.Font = Enum.Font.SourceSansBold
    categoryLabelSettings.TextSize = 18
    categoryLabelSettings.Parent = tabContents["Settings"]
    print("Settings category label created at Y: " .. baseYSettings)

    local yOffsetSettings = baseYSettings + 40
    local PlayerListToggle = Instance.new("TextButton")
    PlayerListToggle.Size = UDim2.new(0, 240, 0, 30)
    PlayerListToggle.Position = UDim2.new(0, 10, 0, yOffsetSettings)
    PlayerListToggle.Text = "☐ Player List: " .. (playerListEnabled and "ON" or "OFF")
    PlayerListToggle.BackgroundTransparency = 1
    PlayerListToggle.TextColor3 = playerListEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
    PlayerListToggle.Font = Enum.Font.SourceSans
    PlayerListToggle.TextSize = 16
    PlayerListToggle.Parent = tabContents["Settings"]
    print("PlayerList toggle created at Y: " .. yOffsetSettings)

    local PlayerListBindSquare = Instance.new("TextButton")
    PlayerListBindSquare.Size = UDim2.new(0, 30, 0, 30)
    PlayerListBindSquare.Position = UDim2.new(0, 260, 0, yOffsetSettings)
    PlayerListBindSquare.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    PlayerListBindSquare.Text = settings.keyBinds.PlayerList and settings.keyBinds.PlayerList.Name or "Bind"
    PlayerListBindSquare.BackgroundTransparency = 0
    PlayerListBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
    PlayerListBindSquare.Font = Enum.Font.SourceSans
    PlayerListBindSquare.TextSize = 12
    PlayerListBindSquare.Parent = tabContents["Settings"]

    local PlayerListUnbindButton = Instance.new("TextButton")
    PlayerListUnbindButton.Size = UDim2.new(0, 50, 0, 30)
    PlayerListUnbindButton.Position = UDim2.new(0, 300, 0, yOffsetSettings)
    PlayerListUnbindButton.Text = "Unbind"
    PlayerListUnbindButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
    PlayerListUnbindButton.TextColor3 = Color3.fromRGB(255, 0, 0)
    PlayerListUnbindButton.Font = Enum.Font.SourceSans
    PlayerListUnbindButton.TextSize = 12
    PlayerListUnbindButton.Parent = tabContents["Settings"]

    yOffsetSettings = yOffsetSettings + 40
    local GuiBindLabel = Instance.new("TextLabel")
    GuiBindLabel.Size = UDim2.new(0, 280, 0, 30)
    GuiBindLabel.Position = UDim2.new(0, 10, 0, yOffsetSettings)
    GuiBindLabel.Text = "GUI Bind: " .. settings.guiBind.Name
    GuiBindLabel.BackgroundTransparency = 1
    GuiBindLabel.TextColor3 = Color3.fromRGB(0, 200, 255)
    GuiBindLabel.Font = Enum.Font.SourceSans
    GuiBindLabel.TextSize = 16
    GuiBindLabel.Parent = tabContents["Settings"]
    print("GuiBind label created at Y: " .. yOffsetSettings)

    yOffsetSettings = yOffsetSettings + 40
    local GuiBindButton = Instance.new("TextButton")
    GuiBindButton.Size = UDim2.new(0, 280, 0, 30)
    GuiBindButton.Position = UDim2.new(0, 10, 0, yOffsetSettings)
    GuiBindButton.Text = "Change GUI Bind"
    GuiBindButton.BackgroundColor3 = Color3.fromRGB(0, 70, 140)
    GuiBindButton.BackgroundTransparency = 0
    GuiBindButton.TextColor3 = Color3.fromRGB(0, 200, 255)
    GuiBindButton.Font = Enum.Font.SourceSans
    GuiBindButton.TextSize = 16
    GuiBindButton.Parent = tabContents["Settings"]
    print("GuiBind button created at Y: " .. yOffsetSettings)

    yOffsetSettings = yOffsetSettings + 40
    local UnbindAllButton = Instance.new("TextButton")
    UnbindAllButton.Size = UDim2.new(0, 280, 0, 30)
    UnbindAllButton.Position = UDim2.new(0, 10, 0, yOffsetSettings)
    UnbindAllButton.Text = "Unbind All Keybinds"
    UnbindAllButton.BackgroundColor3 = Color3.fromRGB(0, 70, 140)
    UnbindAllButton.BackgroundTransparency = 0
    UnbindAllButton.TextColor3 = Color3.fromRGB(255, 0, 0)
    UnbindAllButton.Font = Enum.Font.SourceSans
    UnbindAllButton.TextSize = 16
    UnbindAllButton.Parent = tabContents["Settings"]
    print("UnbindAll button created at Y: " .. yOffsetSettings)

    -- Enhanced Player List GUI with Photos and Health
    local PlayerListFrame = Instance.new("Frame")
    PlayerListFrame.Size = UDim2.new(0, 250, 0, 350)
    PlayerListFrame.Position = UDim2.new(1, -260, 0.5, -175)
    PlayerListFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 30)
    PlayerListFrame.BorderSizePixel = 0
    PlayerListFrame.Visible = playerListEnabled
    PlayerListFrame.Parent = ScreenGui

    local PlayerListTitle = Instance.new("TextLabel")
    PlayerListTitle.Size = UDim2.new(0, 250, 0, 30)
    PlayerListTitle.Position = UDim2.new(0, 0, 0, 0)
    PlayerListTitle.BackgroundTransparency = 1
    PlayerListTitle.Text = "Player List"
    PlayerListTitle.TextColor3 = Color3.fromRGB(0, 200, 255)
    PlayerListTitle.Font = Enum.Font.SourceSansBold
    PlayerListTitle.TextSize = 18
    PlayerListTitle.Parent = PlayerListFrame

    local PlayerListScroll = Instance.new("ScrollingFrame")
    PlayerListScroll.Size = UDim2.new(0, 250, 0, 320)
    PlayerListScroll.Position = UDim2.new(0, 0, 0, 30)
    PlayerListScroll.BackgroundTransparency = 1
    PlayerListScroll.ScrollBarThickness = 5
    PlayerListScroll.Parent = PlayerListFrame

    local function updatePlayerList()
        for _, child in pairs(PlayerListScroll:GetChildren()) do
            if child:IsA("Frame") then
                child:Destroy()
            end
        end

        local yOffsetPlayerList = 0
        for _, player in pairs(PlayersService:GetPlayers()) do
            local PlayerFrame = Instance.new("Frame")
            PlayerFrame.Size = UDim2.new(0, 230, 0, 60)
            PlayerFrame.Position = UDim2.new(0, 10, 0, yOffsetPlayerList)
            PlayerFrame.BackgroundTransparency = 1
            PlayerFrame.Parent = PlayerListScroll

            local PlayerPhoto = Instance.new("ImageLabel")
            PlayerPhoto.Size = UDim2.new(0, 50, 0, 50)
            PlayerPhoto.Position = UDim2.new(0, 0, 0, 5)
            PlayerPhoto.BackgroundTransparency = 1
            local success, thumb = pcall(function()
                return PlayersService:GetUserThumbnailAsync(player.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size48x48)
            end)
            PlayerPhoto.Image = success and thumb or "rbxasset://textures/ui/GuiImagePlaceholder.png"
            PlayerPhoto.Parent = PlayerFrame

            local PlayerButton = Instance.new("TextButton")
            PlayerButton.Size = UDim2.new(0, 170, 0, 30)
            PlayerButton.Position = UDim2.new(0, 60, 0, 5)
            PlayerButton.BackgroundTransparency = 1
            PlayerButton.Text = player.Name
            PlayerButton.TextColor3 = player == LocalPlayer and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
            PlayerButton.Font = Enum.Font.SourceSans
            PlayerButton.TextSize = 16
            PlayerButton.TextXAlignment = Enum.TextXAlignment.Left
            PlayerButton.Parent = PlayerFrame

            local HealthBar = Instance.new("Frame")
            HealthBar.Size = UDim2.new(0, 170, 0, 10)
            HealthBar.Position = UDim2.new(0, 60, 0, 40)
            HealthBar.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            HealthBar.BorderSizePixel = 0
            HealthBar.Parent = PlayerFrame

            local HealthFill = Instance.new("Frame")
            HealthFill.Size = UDim2.new(0, 0, 1, 0)
            HealthFill.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
            HealthFill.BorderSizePixel = 0
            HealthFill.Parent = HealthBar

            local humanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                local healthPercent = humanoid.Health / humanoid.MaxHealth
                HealthFill.Size = UDim2.new(healthPercent, 0, 1, 0)
                HealthFill.BackgroundColor3 = Color3.fromRGB(255 * (1 - healthPercent), 255 * healthPercent, 0)
            end

            PlayerButton.MouseButton1Click:Connect(function()
                local character = getCharacter()
                local rootPart = character and character:FindFirstChild("HumanoidRootPart")
                local targetRootPart = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
                if rootPart and targetRootPart then
                    rootPart.CFrame = targetRootPart.CFrame + Vector3.new(0, 5, 0)
                end
            end)

            humanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid.HealthChanged:Connect(function(health)
                    local healthPercent = health / humanoid.MaxHealth
                    HealthFill.Size = UDim2.new(healthPercent, 0, 1, 0)
                    HealthFill.BackgroundColor3 = Color3.fromRGB(255 * (1 - healthPercent), 255 * healthPercent, 0)
                end)
            end

            yOffsetPlayerList = yOffsetPlayerList + 70
        end
        PlayerListScroll.CanvasSize = UDim2.new(0, 0, 0, yOffsetPlayerList)
    end

    PlayersService.PlayerAdded:Connect(function(player)
        wait(1) -- Wait for character to load
        updatePlayerList()
    end)
    PlayersService.PlayerRemoving:Connect(updatePlayerList)
    updatePlayerList()

    -- Settings Connections
    PlayerListToggle.MouseButton1Click:Connect(function()
        playerListEnabled = not playerListEnabled
        PlayerListToggle.Text = "☐ Player List: " .. (playerListEnabled and "ON" or "OFF")
        PlayerListToggle.TextColor3 = playerListEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
        PlayerListFrame.Visible = playerListEnabled
        settings.playerListEnabled = playerListEnabled
        saveSettings()
    end)

    PlayerListBindSquare.MouseButton1Click:Connect(function() startBinding(PlayerListBindSquare) end)
    PlayerListUnbindButton.MouseButton1Click:Connect(function() unbind(PlayerListBindSquare, "PlayerList") end)

    local changingGuiBind = false
    GuiBindButton.MouseButton1Click:Connect(function()
        changingGuiBind = true
        GuiBindButton.Text = "Press Key"
        GuiBindButton.TextColor3 = Color3.fromRGB(255, 255, 0)
    end)

    UnbindAllButton.MouseButton1Click:Connect(function()
        unbindAll = true
        for feature, _ in pairs(settings.keyBinds) do
            settings.keyBinds[feature] = nil
        end
        AimbotBindSquare.Text = "Bind"
        DeadCheckBindSquare.Text = "Bind"
        TeamCheckBindSquare.Text = "Bind"
        SmoothnessBindSquare.Text = "Bind"
        FovCircleBindSquare.Text = "Bind"
        FlyBindSquare.Text = "Bind"
        NoClipBindSquare.Text = "Bind"
        InfiniteJumpBindSquare.Text = "Bind"
        SaveLastPositionBindSquare.Text = "Bind"
        PlayerListBindSquare.Text = "Bind"
        AimbotBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
        DeadCheckBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
        TeamCheckBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
        SmoothnessBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
        FovCircleBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
        FlyBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
        NoClipBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
        InfiniteJumpBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
        SaveLastPositionBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
        PlayerListBindSquare.TextColor3 = Color3.fromRGB(0, 200, 255)
        settings.unbindAll = unbindAll
        saveSettings()
    end)

    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if changingGuiBind and not gameProcessed and input.UserInputType == Enum.UserInputType.Keyboard then
            settings.guiBind = input.KeyCode
            GuiBindLabel.Text = "GUI Bind: " .. settings.guiBind.Name
            GuiBindButton.Text = "Change GUI Bind"
            GuiBindButton.TextColor3 = Color3.fromRGB(0, 200, 255)
            saveSettings()
            changingGuiBind = false
        elseif not gameProcessed and settings.keyBinds.PlayerList and input.KeyCode == settings.keyBinds.PlayerList then
            playerListEnabled = not playerListEnabled
            PlayerListToggle.Text = "☐ Player List: " .. (playerListEnabled and "ON" or "OFF")
            PlayerListToggle.TextColor3 = playerListEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 200, 255)
            PlayerListFrame.Visible = playerListEnabled
            settings.playerListEnabled = playerListEnabled
            saveSettings()
        end
    end)

    -- Character Reset Handling
    LocalPlayer.CharacterAdded:Connect(function(character)
        wait(1) -- Wait for character to fully load
        if flyEnabled then
            stopFlying()
            startFlying()
        end
        if noClipEnabled then
            updateNoClip(true)
        end
    end)

    -- Initial States
    if flyEnabled then startFlying() end
    if noClipEnabled then updateNoClip(true) end
    canInfiniteJump = infiniteJumpEnabled

    print("Nettleware Alpha script loaded successfully!")
end)

if not success then
    warn("Script encountered an error: " .. err)
end
